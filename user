#!/bin/bash

dot_dirs="./shared_desktop/home"

if [ ! -z "$HOST" ]; then
    if [ ! -d "./$HOST" ]; then
        echoerr "No directory found for $HOST"
        exit 1
    fi
    dot_dirs+=" ./$HOST/home/"
else
    echo "No host defined, only configuring shared home conf"
fi

create_dirs() {
    for dir in $dot_dirs; do
        if [ -d "$dir" ]; then
            pushd $dir
                to_create=$(find . -mindepth 1 -type d -printf "%P ")
                for d in $to_create; do
                    mkdir -p "$HOME/$d"
                done
            popd
        fi
    done
}

create_links() {
    for dir in $dot_dirs; do
        if [ -d "$dir" ]; then
            pushd $dir
                to_create=$(find . -mindepth 1 -type f -printf "%P ")
                for d in $to_create; do
                    ln -sf "$(pwd)/$d" "$HOME/$d"
                done
            popd
        fi
    done
}

configure_neovim() {
    dest="${XDG_DATA_HOME:-$HOME/.local/share}"/nvim/site/autoload/plug.vim
    if [ ! -f "$dest" ]; then
        curl -fLo "$dest" --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
    fi
    nvim --headless +PlugInstall +qall
    nvim --headless +GoInstallBinaries +qall
    echo
}

configure_gnome() {
    dconf load / < dconf-settings.ini
}

create_dirs
create_links
configure_neovim
#configure_gnome
